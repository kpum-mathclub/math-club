<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>活動予定 | 数学研究部</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..800&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    :root{
      --bg:#0b0d12; --fg:#e7e9ee; --muted:#9aa3af;
      --glass:rgba(255,255,255,.06); --border:rgba(255,255,255,.16);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --accent:#54d6a3; --accent-2:#5da8ff;
    }
    html,body{height:100%}
    body {
      margin: 0;
      color: var(--fg);
      background:
        radial-gradient(1000px 600px at 15% 20%, rgba(84,214,163,.18), transparent 60%),
        radial-gradient(900px 700px at 85% 70%, rgba(93,168,255,.16), transparent 55%),
        linear-gradient(180deg, #0b0d12, #0b0d12 100%);
      font-family: "Inter", system-ui, -apple-system, "Noto Serif JP", serif;
      -webkit-font-smoothing: antialiased;
      padding-top: 64px; /* navのぶん */
      overflow-x: hidden;
    }
    /* Nav */
    nav {
      position: fixed; inset: 0 0 auto 0; z-index: 999;
      display:flex; gap:20px; align-items:center;
      padding: 12px 24px;
      color:#fff;
      background: linear-gradient(180deg, rgba(0,0,0,.38), rgba(0,0,0,.08)), var(--glass);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      font-size: 16px;
      box-shadow: var(--shadow);
    }
    nav .brand{
      display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.02em;
      font-family:"Noto Serif JP", serif;
    }
    nav .brand-badge{
      width:30px; height:30px; display:grid; place-items:center; border-radius:9px;
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      font-weight:900;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
    nav a{
      color:#fff; text-decoration:none; opacity:.95; border-radius:10px; padding:6px 8px;
    }
    nav a:hover{ background: rgba(255,255,255,.08); }
    nav .spacer{ flex:1; }

    main{ max-width: 1100px; margin: 0 auto; padding: 24px; }
    h1{
      margin: 4px 0 8px; font-size: clamp(24px, 3vw, 34px);
      font-family: "Noto Serif JP", serif; letter-spacing:.02em;
    }
    p a{ color:#9dc4ff; text-decoration:none }
    p a:hover{ text-decoration:underline }

    .card{
      border:1px solid var(--border); border-radius:16px; background:var(--glass);
      box-shadow: var(--shadow); overflow:hidden;
    }
    table{
      width:100%; border-collapse:collapse; color:var(--fg); font-size:15px;
    }
    thead{ background: rgba(255,255,255,.06); }
    th, td{
      border-bottom:1px solid var(--border); padding:12px 14px; text-align:center;
    }
    th{ font-weight:700; }
    tr:last-child td{ border-bottom:none; }

    /* p5 canvas は背面 */
    #bg-canvas{
      position: fixed; inset: 0; z-index: -1; pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- ナビゲーションバー -->
  <nav>
    <div class="brand">
      <div class="brand-badge">∑</div>
      <div>京都府立医科大学 数学研究部</div>
    </div>
    <div class="spacer"></div>
    <a href="index.html">Home</a>
    <a href="schedule.html">Schedule</a>
    <a href="contact.html">Contact</a>
    <a href="qa.html">Q&amp;A</a>
  </nav>

  <main>
    <h1>数学研究部の活動予定</h1>
    <p><a href="index.html">← トップページへ戻る</a></p>

    <section class="card">
      <table>
        <thead>
          <tr><th>日付</th><th>内容</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>2025年11月までに</td>
            <td>Trias祭の問題作製</td>
          </tr>
          <tr>
            <td>2025/11/1,2</td>
            <td>Trias Festival at KPUM</td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <!-- ===== 背景：宇宙（固定星の点滅 + 既存の円運動 + たまに流れ星） ===== -->
  <div id="bg-canvas"></div>
  <script>
    new p5(p => {
      /* =========================
         1) 瞬く固定星（上に重ねる）
         2) 円運動（trailBuffer。サイズ小さめ）
         3) たまに流れ星（上に重ねる）
         ========================= */
      let stars = [];
      const STAR_COUNT = 240;            // 固定星の数
      const STAR_SIZE_MIN = 0.9;
      const STAR_SIZE_MAX = 1.7;

      // 円運動（ベースはそのまま）
      let circles = [];
      const numRings = 20;
      const pointsPerRing = 5;
      let trailBuffer;
      let boosting = false;

      // 流れ星
      const meteors = [];
      const METEOR_RATE = 0.012; // 低確率（秒あたり）。多ければ上げる
      const METEOR_SPEED = 12;
      const METEOR_TTL = 1200;   // ms

      // 円の点サイズ（小さく調整）
      const ORBIT_DOT = 2.2;     // 残像の点
      const ORBIT_CORE = 3.0;    // 中心の点

      p.setup = () => {
        const cnv = p.createCanvas(p.windowWidth, p.windowHeight);
        cnv.parent('bg-canvas');
        cnv.style('z-index', '-1');
        cnv.style('pointer-events', 'none');
        p.angleMode(p.DEGREES);

        trailBuffer = p.createGraphics(p.width, p.height);
        trailBuffer.clear();
        trailBuffer.angleMode(p.DEGREES);

        initStars();
        initCircles();
      };

      function initStars(){
        stars.length = 0;
        for (let i = 0; i < STAR_COUNT; i++) {
          const periodSec = p.random(1.2, 5.0); // 星ごとに異なる点滅周期
          const phaseSec  = p.random(0, periodSec);
          stars.push({
            x: p.random(p.width),
            y: p.random(p.height),
            size: p.random(STAR_SIZE_MIN, STAR_SIZE_MAX),
            periodSec,
            phaseSec,
            minA: p.random(130, 170),
            maxA: p.random(210, 255)
          });
        }
      }

      function initCircles(){
        circles.length = 0;
        const centerX = p.width / 2;
        const centerY = p.height / 2;

        for (let r = 1; r <= numRings; r++) {
          const radius = r * 40;
          for (let i = 0; i < pointsPerRing; i++) {
            const angle = p.random(360);
            const baseSpeed = p.random(0.1, 0.5) * (r * 0.1);
            circles.push({
              r: radius,
              angle: angle,
              baseSpeed: baseSpeed,
              currentSpeed: baseSpeed,
              centerX,
              centerY
            });
          }
        }
      }

      function maybeSpawnMeteor(dtMs){
        const prob = METEOR_RATE * (dtMs / 1000);
        if (Math.random() < prob) {
          // 画面の外側から右下へ
          const fromTop = Math.random() < 0.5;
          const startX = fromTop ? p.random(-p.width*0.2, p.width*0.9) : -p.width*0.2;
          const startY = fromTop ? -p.height*0.15 : p.random(-p.height*0.1, p.height*0.7);
          const angle = p.random(20, 35); // 右下方向
          meteors.push({
            x: startX,
            y: startY,
            vx: METEOR_SPEED * Math.cos(p.radians(angle)),
            vy: METEOR_SPEED * Math.sin(p.radians(angle)),
            born: p.millis()
          });
        }
      }

      p.draw = () => {
        const nowSec = p.millis() / 1000;
        const dtMs = p.deltaTime;

        // 背景クリア（透明）
        p.clear();

        // ---- 円運動（trailBufferへ描画）
        // 残像フェード（黒で薄く）
        trailBuffer.noStroke();
        trailBuffer.fill(0, 18);          // ← 少しだけ暗く。濃ければ数値↑
        trailBuffer.rect(0, 0, p.width, p.height);

        for (let c of circles) {
          let speedFactor = boosting ? 6 : 1.0;
          c.currentSpeed = c.baseSpeed * speedFactor;

          const x = c.centerX + p.cos(c.angle) * c.r;
          const y = c.centerY + p.sin(c.angle) * c.r;

          // 軌跡の細点
          trailBuffer.noStroke();
          trailBuffer.fill(255, 255, 255, 140);
          trailBuffer.ellipse(x, y, ORBIT_DOT);

          // 中心の点（小さめ）
          trailBuffer.noStroke();
          trailBuffer.fill(255);
          trailBuffer.ellipse(x, y, ORBIT_CORE);

          c.angle += c.currentSpeed;
        }

        // 一度、残像レイヤーを先に合成
        p.image(trailBuffer, 0, 0);

        // ---- 瞬く固定星（常に前面に）
        p.noStroke();
        for (const s of stars) {
          const u = ((nowSec + s.phaseSec) / s.periodSec) % 1;      // [0,1)
          const blink = 0.5 * (1 - Math.cos(p.TWO_PI * u));          // 0→1→0
          const alpha = p.lerp(s.minA, s.maxA, blink);
          p.fill(255, 255, 255, alpha);
          p.circle(s.x, s.y, s.size);
        }

        // ---- 流れ星（固定星の上に）
        maybeSpawnMeteor(dtMs);
        for (let i = meteors.length - 1; i >= 0; i--) {
          const m = meteors[i];
          const age = p.millis() - m.born;
          m.x += m.vx;
          m.y += m.vy;

          // 尾を引く
          const tailLen = 80;
          const alpha = p.map(age, 0, METEOR_TTL, 255, 0);
          const tailX = m.x - tailLen;
          const tailY = m.y - tailLen * (m.vy / (m.vx || 0.0001)); // 0割防止

          p.stroke(255, 255, 255, alpha);
          p.strokeWeight(2);
          p.line(m.x, m.y, tailX, tailY);

          p.noStroke();
          p.fill(255, 255, 255, alpha);
          p.circle(m.x, m.y, 3.2);

          if (age > METEOR_TTL || m.x > p.width + 100 || m.y > p.height + 100) {
            meteors.splice(i, 1);
          }
        }
      };

      // 入力（既存のブースト操作は維持）
      p.touchStarted = () => { boosting = true; };
      p.touchEnded   = () => { boosting = false; };
      p.mousePressed = () => { boosting = true; };
      p.mouseReleased= () => { boosting = false; };

      p.windowResized = () => {
        p.resizeCanvas(p.windowWidth, p.windowHeight);
        trailBuffer = p.createGraphics(p.width, p.height);
        trailBuffer.clear();
        trailBuffer.angleMode(p.DEGREES);
        initStars(); // 固定星は再配置
        const cx = p.width / 2, cy = p.height / 2;
        for (let c of circles) { c.centerX = cx; c.centerY = cy; }
      };
    });
  </script>
</body>
</html>
